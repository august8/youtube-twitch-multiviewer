<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      http-equiv="Content-Security-Policy"
      content="frame-src https://www.youtube.com https://www.youtube-nocookie.com https://player.twitch.tv https://www.twitch.tv;"
    />
    <title>ğŸ¬ YouTube / Twitch ãƒãƒ«ãƒãƒ“ãƒ¥ãƒ¼ã‚¢</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: Arial, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        overflow: hidden;
        background-color: #121212;
        color: #f0f0f0;
      }
      .video-container {
        display: grid;
        justify-content: center;
        align-content: center;
        width: 100vw;
        height: 100vh;
        gap: 10px;
        padding: 10px;
      }
      .video-item {
        display: flex;
        gap: 10px;
        background: #1a1a1a;
        border-radius: 8px;
        overflow: hidden;
        min-width: 0;
      }
      .video-section {
        display: flex;
        flex-direction: column;
        flex: 1;
        min-width: 0;
      }
      .video-wrapper {
        position: relative;
        background: #000;
        flex: 1;
        min-width: 0;
      }
      .video-wrapper iframe {
        width: 100%;
        height: 100%;
        border: none;
      }
      .video-controls {
        background: #2a2a2a;
        padding: 8px;
        display: flex;
        flex-direction: column;
        gap: 6px;
      }
      .control-row {
        display: flex;
        gap: 5px;
        align-items: center;
        justify-content: space-between;
      }
      .seek-buttons {
        display: flex;
        gap: 3px;
      }
      .time-display {
        font-size: 12px;
        color: #aaa;
        min-width: 60px;
        text-align: center;
      }
      .chat-wrapper {
        position: relative;
        background: #1a1a1a;
        width: 340px;
        min-width: 280px;
        display: none;
      }
      .chat-wrapper.visible {
        display: block;
      }
      .chat-wrapper iframe {
        width: 100%;
        height: 100%;
        border: none;
      }
      .controls-overlay {
        position: absolute;
        top: 5px;
        right: 5px;
        display: flex;
        gap: 5px;
        z-index: 10;
      }
      .control-button {
        background: rgba(0, 0, 0, 0.7);
        color: white;
        border: none;
        border-radius: 4px;
        padding: 5px 10px;
        cursor: pointer;
        font-size: 12px;
        backdrop-filter: blur(4px);
      }
      .control-button:hover {
        background: rgba(0, 0, 0, 0.9);
      }
      .control-button.delete {
        background: rgba(220, 53, 69, 0.8);
      }
      .control-button.delete:hover {
        background: rgba(220, 53, 69, 1);
      }
      .control-button.chat {
        background: rgba(0, 123, 255, 0.8);
      }
      .control-button.chat:hover {
        background: rgba(0, 123, 255, 1);
      }
      .control-button.chat.active {
        background: rgba(40, 167, 69, 0.8);
      }
      .control-button.mute {
        background: rgba(108, 117, 125, 0.8);
      }
      .control-button.mute:hover {
        background: rgba(108, 117, 125, 1);
      }
      .seek-button {
        background: rgba(0, 123, 255, 0.7);
        color: white;
        border: none;
        border-radius: 3px;
        padding: 4px 8px;
        cursor: pointer;
        font-size: 11px;
        min-width: 45px;
      }
      .seek-button:hover {
        background: rgba(0, 123, 255, 0.9);
      }
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.8);
        align-items: center;
        justify-content: center;
        z-index: 1000;
      }
      .modal.visible {
        display: flex;
      }
      .modal-content {
        background: #1e1e1e;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        width: 90%;
        max-width: 500px;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .modal-content input[type='text'] {
        padding: 10px;
        font-size: 14px;
        border: none;
        border-radius: 4px;
        width: 100%;
        margin-bottom: 10px;
      }
      .modal-content .checkbox-container {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 10px;
      }
      .modal-content .checkbox-container input[type='checkbox'] {
        width: auto;
        margin: 0;
      }
      .modal-content .button-container {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: space-between;
      }
      .modal-content button {
        flex: 1;
        padding: 10px;
        font-size: 14px;
        border: none;
        border-radius: 4px;
        background: #007bff;
        color: #fff;
        cursor: pointer;
        min-width: 48%;
      }
      .modal-content button:hover {
        background: #0056b3;
      }
      .modal-content .reset {
        background: #dc3545;
      }
      .modal-content .reset:hover {
        background: #a71d2a;
      }
      .modal-content .close-modal {
        background: #6c757d;
      }
      .modal-content .close-modal:hover {
        background: #5a6268;
      }
      .toggle-modal {
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 10px 15px;
        font-size: 16px;
        border: none;
        border-radius: 50%;
        background: #007bff;
        color: #fff;
        cursor: pointer;
        z-index: 1000;
        width: 50px;
        height: 50px;
      }
      .toggle-modal:hover {
        background: #0056b3;
      }
      .welcome-screen {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        max-width: 800px;
        margin: 0 auto;
        padding: 40px 20px;
        text-align: center;
      }
      .welcome-screen h1 {
        font-size: 32px;
        margin-bottom: 20px;
        color: #4a9eff;
      }
      .welcome-screen p {
        font-size: 16px;
        line-height: 1.6;
        margin-bottom: 30px;
        color: #ccc;
      }
      .feature-list {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
        text-align: left;
      }
      .feature-item {
        background: #1a1a1a;
        padding: 20px;
        border-radius: 8px;
        border: 1px solid #333;
      }
      .feature-item h3 {
        font-size: 18px;
        margin-bottom: 10px;
        color: #4a9eff;
      }
      .feature-item p {
        font-size: 14px;
        color: #aaa;
        margin: 0;
      }
      .start-button {
        padding: 15px 40px;
        font-size: 18px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: background 0.3s;
      }
      .start-button:hover {
        background: #0056b3;
      }
      .hidden {
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="welcome-screen" id="welcomeScreen">
      <h1>ğŸ¬ YouTube / Twitch ãƒãƒ«ãƒãƒ“ãƒ¥ãƒ¼ã‚¢</h1>
      <p>
        è¤‡æ•°ã®YouTubeãƒ©ã‚¤ãƒ–é…ä¿¡ã‚„Twitchã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚’åŒæ™‚ã«è¦–è´ã§ãã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚<br />
        é…ä¿¡ã‚’æ¯”è¼ƒã—ãŸã‚Šã€è¤‡æ•°ã®è¦–ç‚¹ã‹ã‚‰æ¥½ã—ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚
      </p>

      <div class="feature-list">
        <div class="feature-item">
          <h3>ğŸ“º è¤‡æ•°é…ä¿¡ã®åŒæ™‚è¦–è´</h3>
          <p>YouTubeãƒ»Twitchã®é…ä¿¡ã‚’åŒæ™‚ã«è¡¨ç¤ºã€‚ç”»é¢ã¯è‡ªå‹•ã§ã‚°ãƒªãƒƒãƒ‰é…ç½®ã•ã‚Œã¾ã™ã€‚</p>
        </div>
        <div class="feature-item">
          <h3>ğŸ’¬ ãƒ©ã‚¤ãƒ–ãƒãƒ£ãƒƒãƒˆè¡¨ç¤º</h3>
          <p>å„é…ä¿¡ã®ãƒãƒ£ãƒƒãƒˆã‚’è¡¨ç¤ºå¯èƒ½ã€‚ãƒ©ã‚¤ãƒ–é…ä¿¡ã‚„VODã®ãƒãƒ£ãƒƒãƒˆãƒªãƒ—ãƒ¬ã‚¤ã«å¯¾å¿œã€‚</p>
        </div>
        <div class="feature-item">
          <h3>â±ï¸ å†ç”Ÿæ™‚é–“ã®å¾®èª¿æ•´</h3>
          <p>YouTubeå‹•ç”»ã¯Â±5ç§’/10ç§’ã®ã‚·ãƒ¼ã‚¯ãƒœã‚¿ãƒ³ã§é…ä¿¡ã®ã‚ºãƒ¬ã‚’èª¿æ•´ã§ãã¾ã™ã€‚</p>
        </div>
      </div>

      <button class="start-button" id="startButton">ä½¿ã„å§‹ã‚ã‚‹</button>
    </div>

    <div class="video-container hidden" id="videoContainer"></div>
    <div class="modal" id="controlsModal">
      <div class="modal-content">
        <input type="text" id="videoUrl" placeholder="YouTube ã¾ãŸã¯ Twitch ã® URL ã‚’å…¥åŠ›" />
        <div class="checkbox-container" id="liveCheckContainer">
          <input type="checkbox" id="isLiveStream" checked />
          <label for="isLiveStream">ãƒ©ã‚¤ãƒ–é…ä¿¡ï¼ˆãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã‚’æœ‰åŠ¹åŒ–ï¼‰</label>
        </div>

        <div class="button-container">
          <button id="addVideo">è¿½åŠ </button>
          <button id="resetVideos" class="reset">ãƒªã‚»ãƒƒãƒˆ</button>
        </div>
        <button class="close-modal" id="closeModal">é–‰ã˜ã‚‹</button>
        <div
          style="
            text-align: center;
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid #444;
            font-size: 12px;
            color: #888;
          "
        >
          v1.5.2
        </div>
      </div>
    </div>
    <button class="toggle-modal" id="toggleModal">â˜°</button>

    <script>
      // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ã‚’æœ€åˆã«å®šç¾©
      const welcomeScreen = document.getElementById('welcomeScreen')
      const videoContainer = document.getElementById('videoContainer')
      const videoUrlInput = document.getElementById('videoUrl')
      const controlsModal = document.getElementById('controlsModal')
      const toggleModalButton = document.getElementById('toggleModal')
      const closeModalButton = document.getElementById('closeModal')
      const isLiveStream = document.getElementById('isLiveStream')
      const liveCheckContainer = document.getElementById('liveCheckContainer')
      const startButton = document.getElementById('startButton')

      let players = {}
      let playerReady = {}
      let ytApiReady = false

      // ã‚¦ã‚§ãƒ«ã‚«ãƒ ç”»é¢ã‚’éè¡¨ç¤ºã«ã—ã¦é–‹å§‹
      startButton.addEventListener('click', () => {
        welcomeScreen.classList.add('hidden')
        videoContainer.classList.remove('hidden')
        controlsModal.classList.add('visible')
      })

      // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚ˆã‚Šå…ˆã«å®šç¾©ï¼‰
      function isDarkMode() {
        // ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å›ºå®š
        return true
      }

      function detectPlatform(url) {
        if (url.includes('youtube.com') || url.includes('youtu.be')) {
          return 'youtube'
        } else if (url.includes('twitch.tv')) {
          return 'twitch'
        }
        return null
      }

      function extractVideoId(url) {
        const patterns = [
          /(?:youtube\.com\/watch\?v=)([^&\s]+)/,
          /(?:youtu\.be\/)([^&\s?]+)/,
          /(?:youtube\.com\/live\/)([^&\s?]+)/,
          /(?:youtube\.com\/embed\/)([^&\s?]+)/,
        ]

        for (const pattern of patterns) {
          const match = url.match(pattern)
          if (match) return match[1]
        }
        return null
      }

      function extractTwitchChannel(url) {
        const vodPattern = /(?:twitch\.tv\/videos\/)(\d+)/
        const vodMatch = url.match(vodPattern)
        if (vodMatch) {
          return { type: 'vod', id: vodMatch[1] }
        }

        const channelPatterns = [/(?:twitch\.tv\/)([^\/\s?]+)/, /(?:www\.twitch\.tv\/)([^\/\s?]+)/]

        for (const pattern of channelPatterns) {
          const match = url.match(pattern)
          if (match && match[1] !== 'videos') {
            return { type: 'channel', id: match[1] }
          }
        }

        return { type: 'channel', id: url.trim() }
      }

      function formatTime(seconds) {
        if (!seconds || isNaN(seconds)) return '0:00'
        const h = Math.floor(seconds / 3600)
        const m = Math.floor((seconds % 3600) / 60)
        const s = Math.floor(seconds % 60)
        if (h > 0) {
          return `${h}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`
        }
        return `${m}:${s.toString().padStart(2, '0')}`
      }

      function updateTimeDisplay(videoId) {
        const player = players[videoId]
        if (player && playerReady[videoId]) {
          try {
            const currentTime = player.getCurrentTime()
            const timeDisplay = document.querySelector(`[data-video-id="${videoId}"] .time-display`)
            if (timeDisplay) {
              timeDisplay.textContent = formatTime(currentTime)
            }
          } catch (e) {
            // Player not ready yet
          }
        }
      }

      function adjustVideoGrid() {
        const videoCount = videoContainer.children.length
        if (videoCount === 0) {
          // å‹•ç”»ãŒãªã„å ´åˆã¯ã‚¦ã‚§ãƒ«ã‚«ãƒ ç”»é¢ã‚’è¡¨ç¤º
          welcomeScreen.classList.remove('hidden')
          videoContainer.classList.add('hidden')
          return
        }

        let cols = videoCount === 1 ? 1 : Math.ceil(Math.sqrt(videoCount))
        let rows = Math.ceil(videoCount / cols)

        videoContainer.style.gridTemplateColumns = `repeat(${cols}, 1fr)`
        videoContainer.style.gridTemplateRows = `repeat(${rows}, 1fr)`
      }

      function seekVideo(videoId, seconds) {
        const player = players[videoId]
        if (player && playerReady[videoId]) {
          const currentTime = player.getCurrentTime()
          const newTime = Math.max(0, currentTime + seconds)
          player.seekTo(newTime, true)
        }
      }

      function createVideoItem(
        videoId,
        platform = 'youtube',
        isLive = true,
        twitchType = 'channel'
      ) {
        const videoItem = document.createElement('div')
        videoItem.className = 'video-item'
        videoItem.dataset.videoId = videoId
        videoItem.dataset.platform = platform

        const videoSection = document.createElement('div')
        videoSection.className = 'video-section'

        const videoWrapper = document.createElement('div')
        videoWrapper.className = 'video-wrapper'

        let playerDiv

        if (platform === 'twitch') {
          playerDiv = document.createElement('iframe')
          playerDiv.id = `player-${videoId}`
          const domain = window.location.hostname || 'localhost'

          if (twitchType === 'vod') {
            playerDiv.src = `https://player.twitch.tv/?video=${videoId}&parent=${domain}&autoplay=false`
          } else {
            playerDiv.src = `https://player.twitch.tv/?channel=${videoId}&parent=${domain}`
          }

          playerDiv.allowFullscreen = true
          playerDiv.style.width = '100%'
          playerDiv.style.height = '100%'
        } else {
          playerDiv = document.createElement('div')
          playerDiv.id = `player-${videoId}`
        }

        const controlsOverlay = document.createElement('div')
        controlsOverlay.className = 'controls-overlay'

        const muteButton = document.createElement('button')
        muteButton.className = 'control-button mute'
        muteButton.textContent = 'ğŸ”Š'

        if (platform === 'youtube') {
          muteButton.addEventListener('click', () => {
            const player = players[videoId]
            if (player && playerReady[videoId]) {
              const isMuted = player.isMuted()
              if (isMuted) {
                player.unMute()
                muteButton.textContent = 'ğŸ”Š'
              } else {
                player.mute()
                muteButton.textContent = 'ğŸ”‡'
              }
            }
          })
        } else {
          muteButton.style.opacity = '0.3'
          muteButton.style.cursor = 'not-allowed'
          muteButton.title = 'Twitchãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ç›´æ¥æ“ä½œã—ã¦ãã ã•ã„'
        }

        const chatButton = document.createElement('button')
        chatButton.className = 'control-button chat'
        chatButton.textContent = 'ğŸ’¬'
        chatButton.title = 'ãƒãƒ£ãƒƒãƒˆã‚’é–‹ã'

        if (isLive) {
          chatButton.addEventListener('click', () => {
            const chatWrapper = videoItem.querySelector('.chat-wrapper')
            chatWrapper.classList.toggle('visible')
            chatButton.classList.toggle('active')
          })

          if (platform === 'youtube') {
            chatButton.addEventListener('contextmenu', (e) => {
              e.preventDefault()
              const darkMode = isDarkMode() ? 1 : 0
              const chatUrl = `https://www.youtube.com/live_chat?is_popout=1&v=${videoId}&dark_theme=${darkMode}`
              window.open(chatUrl, `chat_${videoId}`, 'width=400,height=600,scrollbars=yes')
            })
          }
        } else {
          chatButton.style.opacity = '0.3'
          chatButton.style.cursor = 'not-allowed'
          chatButton.title = 'ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–å‹•ç”»ã§ã¯ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã¯åˆ©ç”¨ã§ãã¾ã›ã‚“'
          chatButton.addEventListener('click', (e) => {
            e.preventDefault()
            alert(
              'ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–å‹•ç”»ã§ã¯ãƒãƒ£ãƒƒãƒˆãƒªãƒ—ãƒ¬ã‚¤ã¯åˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚\nãƒ©ã‚¤ãƒ–é…ä¿¡ä¸­ã®å‹•ç”»ã®ã¿ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ãŒæœ‰åŠ¹ã§ã™ã€‚'
            )
          })
        }

        const deleteButton = document.createElement('button')
        deleteButton.className = 'control-button delete'
        deleteButton.textContent = 'âœ•'
        deleteButton.addEventListener('click', () => {
          if (players[videoId]) {
            players[videoId].destroy()
            delete players[videoId]
            delete playerReady[videoId]
          }
          videoItem.remove()
          adjustVideoGrid()
        })

        controlsOverlay.appendChild(muteButton)
        controlsOverlay.appendChild(chatButton)
        controlsOverlay.appendChild(deleteButton)

        videoWrapper.appendChild(playerDiv)
        videoWrapper.appendChild(controlsOverlay)

        if (platform === 'youtube') {
          const videoControls = document.createElement('div')
          videoControls.className = 'video-controls'

          const controlRow1 = document.createElement('div')
          controlRow1.className = 'control-row'

          const seekButtons = document.createElement('div')
          seekButtons.className = 'seek-buttons'

          const seek10Back = document.createElement('button')
          seek10Back.className = 'seek-button'
          seek10Back.textContent = 'â®ï¸ -10s'
          seek10Back.addEventListener('click', () => seekVideo(videoId, -10))

          const seek5Back = document.createElement('button')
          seek5Back.className = 'seek-button'
          seek5Back.textContent = 'âª -5s'
          seek5Back.addEventListener('click', () => seekVideo(videoId, -5))

          const seek5Forward = document.createElement('button')
          seek5Forward.className = 'seek-button'
          seek5Forward.textContent = 'â© +5s'
          seek5Forward.addEventListener('click', () => seekVideo(videoId, 5))

          const seek10Forward = document.createElement('button')
          seek10Forward.className = 'seek-button'
          seek10Forward.textContent = 'â­ï¸ +10s'
          seek10Forward.addEventListener('click', () => seekVideo(videoId, 10))

          seekButtons.appendChild(seek10Back)
          seekButtons.appendChild(seek5Back)
          seekButtons.appendChild(seek5Forward)
          seekButtons.appendChild(seek10Forward)

          const timeDisplay = document.createElement('div')
          timeDisplay.className = 'time-display'
          timeDisplay.textContent = '0:00'

          controlRow1.appendChild(seekButtons)
          controlRow1.appendChild(timeDisplay)

          videoControls.appendChild(controlRow1)

          videoSection.appendChild(videoWrapper)
          videoSection.appendChild(videoControls)
        } else {
          videoSection.appendChild(videoWrapper)
        }

        let chatWrapper = null
        if (isLive) {
          chatWrapper = document.createElement('div')
          chatWrapper.className = 'chat-wrapper'

          const chatIframe = document.createElement('iframe')
          const domain = window.location.hostname || 'localhost'
          const darkMode = isDarkMode() ? 1 : 0

          if (platform === 'twitch') {
            const twitchDark = darkMode ? '&darkpopout' : ''
            if (twitchType === 'vod') {
              chatIframe.src = `https://www.twitch.tv/videos/${videoId}/chat?parent=${domain}${twitchDark}`
            } else {
              chatIframe.src = `https://www.twitch.tv/embed/${videoId}/chat?parent=${domain}${twitchDark}`
            }
          } else {
            chatIframe.src = `https://www.youtube.com/live_chat?is_popout=1&v=${videoId}&embed_domain=${domain}&dark_theme=${darkMode}`
          }

          chatIframe.allow =
            'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture'

          chatWrapper.appendChild(chatIframe)
        }

        videoItem.appendChild(videoSection)
        if (chatWrapper) {
          videoItem.appendChild(chatWrapper)
        }

        return videoItem
      }

      function initializePlayer(videoId) {
        if (!ytApiReady) {
          setTimeout(() => initializePlayer(videoId), 200)
          return
        }

        playerReady[videoId] = false

        try {
          players[videoId] = new YT.Player(`player-${videoId}`, {
            height: '100%',
            width: '100%',
            videoId: videoId,
            playerVars: {
              enablejsapi: 1,
              origin: window.location.origin,
              autoplay: 0,
            },
            events: {
              onReady: (event) => {
                playerReady[videoId] = true
                setInterval(() => updateTimeDisplay(videoId), 1000)
              },
              onError: (event) => {
                alert(
                  `å‹•ç”»ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ (Code: ${event.data})\n100: å‹•ç”»ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“\n101/150: åŸ‹ã‚è¾¼ã¿ãŒè¨±å¯ã•ã‚Œã¦ã„ã¾ã›ã‚“`
                )
              },
            },
          })
        } catch (error) {
          console.error(`Failed to initialize player ${videoId}:`, error)
        }
      }

      // YouTube IFrame APIã®èª­ã¿è¾¼ã¿
      function loadYouTubeAPI() {
        const tag = document.createElement('script')
        tag.src = 'https://www.youtube.com/iframe_api'
        const firstScriptTag = document.getElementsByTagName('script')[0]
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag)
      }

      window.onYouTubeIframeAPIReady = function () {
        ytApiReady = true
      }

      // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ï¼ˆã™ã¹ã¦ã®é–¢æ•°å®šç¾©ã®å¾Œã«é…ç½®ï¼‰
      document.getElementById('addVideo').addEventListener('click', () => {
        const urlInput = videoUrlInput.value.trim()
        const platform = detectPlatform(urlInput)

        if (!platform) {
          alert('YouTube ã¾ãŸã¯ Twitch ã® URL ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚')
          return
        }

        let videoId
        let twitchType = 'channel'
        let isLive = true

        if (platform === 'youtube') {
          videoId = extractVideoId(urlInput)
          isLive = isLiveStream.checked
        } else if (platform === 'twitch') {
          const twitchData = extractTwitchChannel(urlInput)
          videoId = twitchData.id
          twitchType = twitchData.type
          isLive = twitchType === 'channel'
        }

        if (videoId) {
          const videoItem = createVideoItem(videoId, platform, isLive, twitchType)
          videoContainer.appendChild(videoItem)
          adjustVideoGrid()

          if (platform === 'youtube') {
            setTimeout(() => initializePlayer(videoId), 100)
          }

          videoUrlInput.value = ''
        } else {
          alert(`æ­£ã—ã„${platform === 'youtube' ? 'YouTube' : 'Twitch'}ã®URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚`)
        }
      })

      document.getElementById('resetVideos').addEventListener('click', () => {
        Object.values(players).forEach((player) => {
          if (player) player.destroy()
        })
        players = {}
        playerReady = {}
        videoContainer.innerHTML = ''
        adjustVideoGrid()
      })

      toggleModalButton.addEventListener('click', () => {
        controlsModal.classList.toggle('visible')
      })

      closeModalButton.addEventListener('click', () => {
        controlsModal.classList.remove('visible')
        // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ãŸæ™‚ã«å‹•ç”»ãŒãªã‘ã‚Œã°ã‚¦ã‚§ãƒ«ã‚«ãƒ ç”»é¢ã«æˆ»ã‚‹
        if (videoContainer.children.length === 0) {
          welcomeScreen.classList.remove('hidden')
          videoContainer.classList.add('hidden')
        }
      })

      controlsModal.addEventListener('click', (event) => {
        if (event.target === controlsModal) {
          controlsModal.classList.remove('visible')
          // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ãŸæ™‚ã«å‹•ç”»ãŒãªã‘ã‚Œã°ã‚¦ã‚§ãƒ«ã‚«ãƒ ç”»é¢ã«æˆ»ã‚‹
          if (videoContainer.children.length === 0) {
            welcomeScreen.classList.remove('hidden')
            videoContainer.classList.add('hidden')
          }
        }
      })

      videoUrlInput.addEventListener('keypress', (event) => {
        if (event.key === 'Enter') {
          document.getElementById('addVideo').click()
        }
      })

      videoUrlInput.addEventListener('input', (event) => {
        const url = event.target.value.trim()
        const platform = detectPlatform(url)

        if (platform === 'twitch') {
          const twitchData = extractTwitchChannel(url)
          if (twitchData.type === 'vod') {
            liveCheckContainer.style.display = 'flex'
            isLiveStream.checked = false
          } else {
            liveCheckContainer.style.display = 'none'
            isLiveStream.checked = true
          }
        } else if (platform === 'youtube') {
          liveCheckContainer.style.display = 'flex'
        }
      })

      window.addEventListener('resize', adjustVideoGrid)

      loadYouTubeAPI()
    </script>
  </body>
</html>
